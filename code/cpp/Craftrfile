# bachelorthesis
import os
import shutil

cxx = load('craftr.lang.cxx')
googletest = load('craftr.lib.googletest').googletest

includes = ['src/include', 'deps/include', 'src/main']

mylib = Framework(
  include = [local(x) for x in includes],
  std = 'c++11',
  warn = 'all',
  debug = True,
  libs = ['m', 'gmpxx', 'gmp']
)

mylib_lib = cxx.static_library(
  inputs = cxx.compile_cpp(sources = glob('src/main/*.cpp'), frameworks = [mylib]),
  output = 'mylib'
)
cxx.extend_framework(mylib, mylib_lib)

test_bin = cxx.executable(
  inputs = cxx.compile_cpp(sources = glob('src/test/*.cpp'), frameworks = [googletest, mylib]),
  output = 'test'
)

test = runtarget(test_bin)

run = runtarget(test_bin, '--gtest_filter=Run.DISABLED_FromStdinVerbose' , '--gtest_also_run_disabled_tests')

gdb = gentarget([['gdb', '--args', test_bin]], pool='console', explicit=True)

docs = gentarget([['doxygen', '.doxygen.config']], explicit=True, cwd=project_dir)

# Symlink resource file for execution 
try:
    os.symlink('../src/test/resources', 'resources')
except:
    pass
